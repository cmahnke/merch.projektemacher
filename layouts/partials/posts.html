{{/* TODO: Remove this - the layout should be enough */}}
<div class="content list">
    <section class="container list">
      <article class="posts">
      <header>
          <h1 class="title header">
            {{- if eq .Kind "term" -}}
              {{- i18n .Data.Singular | title -}}
              {{- print ": " -}}
            {{- end -}}
            {{ if ne .Title .Site.Home.Title }}
                {{ .Site.Home.Title }}: {{ .Title }}
            {{ else }}
                {{- .Title -}}
            {{ end }}
          </h1>
      </header>
      {{ partial "section-header.html" . }}
      <div class="post-list-content">
        {{ .Content }}
      </div>
      <ul>

        {{- $pages := where .Site.Pages "Section" .Section -}}
        {{ if .IsHome }}
            {{- $pages = where .Site.Pages "Section" (path.Dir (index .CurrentSection.Sections 0).File.Dir) -}}
        {{ end }}
        {{- .Scratch.Set "pages" $pages -}}
        {{- $mainSite := .Sites.First -}}
        {{- if ne $mainSite .Site -}}
            {{ .Scratch.Set "pages" ($pages | lang.Merge (where $mainSite.Pages "Section" .Section) ) }}
        {{- end -}}
        {{- $pages = .Scratch.Get "pages" -}}
        {{/* Filter non post pages */}}
        {{- $pages = where $pages "Params.displayinlist" "!=" false -}}
        {{- $pages = where $pages "Params.displayInList" "!=" false -}}
        {{- $pages = where $pages "Params.metaPage" "!=" true -}}
        {{- $pages = where $pages "Date.IsZero" "==" false -}}
        {{- $pages = where $pages ".Kind" "!=" "section" -}}

        {{ range $pages }}

        <li>
          <div class="post-heading">
              {{- $dir := split (string (path.Dir .Path)) "/" -}}
              {{- $article := last 1 $dir -}}
              {{- $id := index $dir 1 -}}
              {{- $dir = first (sub (len $dir) 1) $dir -}}
              {{- $section := first 1 $dir -}}
              {{- $displayName := "" -}}
              {{- $postLink := "" -}}
              {{- $prefix := "" -}}
              {{- if gt (len $dir) 1 -}}
                  {{- $prefix = index $dir 1 -}}
              {{- end -}}
              {{- if gt (len $dir) 1 -}}
                {{- $linkPrefix := "" -}}
                {{- $prefix := index $dir 1 -}}
                {{- $sectionHeading := printf "/%s" (delimit (slice "blog" $prefix) "/") -}}
                {{- $blogPage := .Site.GetPage $sectionHeading -}}
                {{- $displayName = printf "%s: " $blogPage.Title -}}
                {{- if ($blogPage.Param "linkPrefix") -}}
                    {{ $linkPrefix = $blogPage.Param "linkPrefix" -}}
                {{- else -}}
                    {{ $linkPrefix = $blogPage.Param "link" -}}
                {{- end -}}
                {{- $postLink = split (string .Path) "/" -}}
                {{- $postLink = last (sub (len $postLink) 2) $postLink -}}
                {{- $postLink = delimit $postLink "/" -}}
                {{- $postLink = replaceRE "^(.*/)\\w*\\..*$" "$1" $postLink -}}
                {{- $postLink = printf "%s%s" $linkPrefix $postLink -}}
              {{- end -}}
              {{ $openExternal := true }}
              {{- if eq $postLink "" }}
                {{- $postLink = printf "#%s" $id -}}
                {{ $openExternal = false }}
              {{- end -}}
            <span class="date">
                {{- partial "date.html" (dict "date" .Date "language" $.Page.Language "months" $.Site.Data.months) -}}
            </span>
            <span class="link">
                <a class="title" href="{{ .RelPermalink }}" {{- if $openExternal -}}target="_blank"{{ else }}data-toggle="collapse"{{- end -}}>{{- $displayName }}{{ .Title -}}</a>
            </span>
          </div>
          <div class="post-snippet">
            {{ if ne .Description ""}}
              <span class="description">{{- .Description | markdownify -}}</span>
            {{ else }}
                <span class="post-spacer">&nbsp;</span>
            {{ end }}
            {{ if not $openExternal }}
              <div class="post-content collapse collapsed" id="{{ $id }}">
                {{ .Content }}
              </div>
            {{ end }}
          </div>
        </li>
        {{ end }}
      </ul>

    </article>
    </section>
</div>
